{% extends "homeparent.html" %}

{% block content %}
<div class="jobs-container">
  <div class="jobs-header">
    <h1>"Looking For" Listings</h1>
    {% if job_count < 3 %}
  <a href="javascript:void(0)" id="openCreateJobModal" class="create-post-button">
    Create Post
  </a>
{% else %}
  <a href="/createjob_disabled"class="create-post-button" title="You have reached the maximum limit of 3 job listings"> Create Post </a>
{% endif %}
  </div>
  
  <div class="jobs-listings">
    {% if jobs|length == 0 %}
      <p>No job posts available. Please check back later or create one!</p>
    {% else %}
      {% for job in jobs %}
      <div class="job-post">
        <h2>{{ job.title }}</h2>
        {% if job.on_demand %}
          <div class="on-demand-tag">On-Demand</div>
        {% endif %}
        <p>{{ job.description }}</p>
        <span class="job-meta">Commission: RM{{ job.commission }}</span><br>
        <span class="job-meta">Posted by: {{ job.user.username }}</span>
        {% if job.on_demand %}
          <button class="take-button">Take</button>
        {% else %}
          <button class="take-button">Contact</button>
        {% endif %}
      </div>
      {% endfor %}
    {% endif %}
  </div>
</div>

<!-- “Create Post” link becomes a button that opens the modal -->

<!-- Modal container -->
<div id="createJobModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>

    <ul class="progress">
      <li id="progress1" class="active">Step 1: Job Details</li>
      <li id="progress2">Step 2: Payment</li>
      <li id="progress3">Step 3: Complete</li>
    </ul>
    
    <!-- Create Job Form Content (from createjob.html) -->
    <form id="jobDetailsForm" action="/lookingFor" method="POST">
      <div id="step1">
        <h2>Add Job Details</h2>
        <div class="toggle-container">
          <span class="toggle-label">On-Demand</span>
          <label class="switch">
            <input type="checkbox" id="onDemandToggle" name="on_demand">
            <span class="slider"></span>
          </label>
        </div>
        <div class="form-group">
          <label for="jobTitle">Job Title:</label>
          <input type="text" name="title" id="jobTitle" placeholder="Enter job title" />
        </div>
        <div class="form-group">
          <label for="jobDescription">Job Description:</label>
          <textarea id="jobDescription" name="description" rows="4" placeholder="Enter job description"></textarea>
        </div>
        <div class="form-group">
          <label for="commission">Commission Cost:</label>
          <input type="number" name="commission" id="commission" placeholder="Enter commission cost" />
        </div>
        <!-- This button does not submit the form; it only transitions the wizard -->
        <button type="button" id="toStep2">Submit Job Details</button>
      </div>
      
      <div id="step2" style="display: none;">
        <h2>Payment</h2>
        <p>Please scan the QR code below to pay the commission amount.</p>
        <div class="qr-mock">
          QR CODE
        </div>
        <!-- This button will simulate the payment and then submit the form -->
        <button type="button" id="simulatePayment">Simulate Payment</button>
      </div>
      
      <div id="step3" style="display: none;">
        <h2>Post Created!</h2>
        <p>Your job post has been successfully created.</p>
      </div>
    </form>
  </div>
</div>

<script>
  // Get modal element and the button that opens it
  var modal = document.getElementById("createJobModal");
  var openModalBtn = document.getElementById("openCreateJobModal");
  var closeBtn = document.getElementsByClassName("close")[0];

  // Open modal when the user clicks the "Create Post" button
  openModalBtn.onclick = function() {
    modal.style.display = "block";
  }

  // Close modal when the user clicks the close button (x)
  closeBtn.onclick = function() {
    modal.style.display = "none";
  }

  // Also close modal if the user clicks anywhere outside the modal content
  window.onclick = function(event) {
    if (event.target == modal) {
      modal.style.display = "none";
    }
  }

  // Toggle button functionality for "On-Demand"
  document.getElementById('onDemandToggle').addEventListener('change', function() {
    if (this.checked) {
      console.log("On-Demand is ON");
      // Add your code to handle the toggled state (on)
    } else {
      console.log("On-Demand is OFF");
      // Add your code to handle the toggled state (off)
    }
  });

  // Transition from Step 1 to Step 2
  document.getElementById('toStep2').addEventListener('click', function() {
    // Minimal validation
    var title = document.getElementById('jobTitle').value;
    var description = document.getElementById('jobDescription').value;
    var commission = document.getElementById('commission').value;
    if (title.trim() === "" || description.trim() === "" || commission.trim() === "") {
      alert("Please fill in all fields.");
      return;
    }
    var isOnDemand = document.getElementById('onDemandToggle').checked;
  
  // Hide Step 1 regardless of the condition
  document.getElementById('step1').style.display = 'none';
  
  if (isOnDemand) {
    // If on-demand is enabled, proceed to Step 2 (Payment)
    document.getElementById('step2').style.display = 'block';
    document.getElementById('progress1').classList.add('active');
    document.getElementById('progress2').classList.add('active');
  } else {
    // If on-demand is disabled, skip Step 2 and directly show Step 3 (Complete)
    document.getElementById('step3').style.display = 'block';
    document.getElementById('progress1').classList.remove('active');
    document.getElementById('progress3').classList.add('active');
    
    // Optionally, auto-submit the form immediately if no payment is required:
    // document.getElementById('jobDetailsForm').submit();
  }
    // Hide step 1 and show step 2
    document.getElementById('step1').style.display = 'none';
    document.getElementById('step2').style.display = 'block';
    // Update progress indicator
    document.getElementById('progress1').classList.remove('active');
    document.getElementById('progress2').classList.add('active');
  });

  // Transition from Step 2 to Step 3 and submit form (simulate payment)
  document.getElementById('simulatePayment').addEventListener('click', function() {
    // Simulate payment success
    // Hide step 2 and show step 3
    document.getElementById('step2').style.display = 'none';
    document.getElementById('step3').style.display = 'block';
    // Update progress indicator
    document.getElementById('progress2').classList.remove('active');
    document.getElementById('progress3').classList.add('active');
    
    // After a delay (if you wish) you can submit the form.
    // For instance, submitting the form immediately:
    document.getElementById('jobDetailsForm').submit();
  });
</script>

{% endblock %}
