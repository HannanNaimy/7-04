{% extends "homeparent.html" %}

{% block content %}
<div class="job-details-container">
  <header class="job-header">
    <span class="label-looking-for">Offering To&gt;</span>
    <h1 class="job-title">{{ offer.title }}</h1>
  </header>

  <section class="job-content">
    <p class="job-description">{{ offer.description }}</p>
  </section>
  
  <footer class="job-footer">
    <p class="job-commission">
      {% if offer.on_demand %}
        Commission: RM{{ offer.commission }}
      {% else %}
        Salary Range: RM{{ offer.salary_range }}
      {% endif %}
    </p>
    {% if offer.on_demand %}
      {# If the current user is the offer creator, disable the button #}
      {% if g.user and offer.creator.id == g.user.id %}
        <button class="job-take-button" onclick="alert('You cannot take your own offer.');">
          Take
        </button>
      {% else %}
        <!-- For allowed users, show the modal trigger -->
        <button class="job-take-button" id="openTakeOfferModal">Take</button>
      {% endif %}
    {% else %}
      <button class="job-contact-button">Contact</button>
    {% endif %}
  </footer>
</div>

<!-- Payment Modal for Taking the Offer (only relevant for onâ€‘demand offers) -->
<div id="takeOfferModal" class="modal" style="display:none;">
  <div class="modal-content">
    <span class="close" id="closeTakeOfferModal">&times;</span>
    <h2>Payment</h2>
    <p>Please scan the QR code below to pay RM{{ offer.commission }}.</p>
    <div class="qr-mock">QR CODE</div>
    <!-- 
      Wrap the "Simulate Payment" button in a form so that the POST submission 
      triggers a full page reload and flash messages will be displayed.
    -->
    <form id="takeOfferForm" action="{{ url_for('take_offer', offer_id=offer.id) }}" method="POST">
      <button type="submit" id="simulatePaymentOffer">Simulate Payment</button>
    </form>
  </div>
</div>

<script>
  // === Modal Controls for Taking an Offer ===
  var takeOfferModal = document.getElementById("takeOfferModal");
  var openTakeOfferModal = document.getElementById("openTakeOfferModal");
  var closeTakeOfferModal = document.getElementById("closeTakeOfferModal");

  if(openTakeOfferModal){ // Only attach if button exists.
    openTakeOfferModal.onclick = function() {
      takeOfferModal.style.display = "block";
    };
  }

  if(closeTakeOfferModal){
    closeTakeOfferModal.onclick = function() {
      takeOfferModal.style.display = "none";
    };
  }

  window.onclick = function(event) {
    if (event.target == takeOfferModal) {
      takeOfferModal.style.display = "none";
    }
  };
  // === End Modal Controls ===
</script>
{% endblock %}
